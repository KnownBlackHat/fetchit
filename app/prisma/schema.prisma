// This is your Prisma schema file,sch
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client"
    output   = "../generated/prisma"
}

datasource db {
    provider = "postgresql"
}

enum Gender {
    Male
    Female
}

model User {
    id       String  @id @default(cuid())
    username String  @unique
    fullname String
    img_url  String?
    password String
    phone_no BigInt
    mail_id  String
    gender   Gender

    userAddress UserAddress[]
}

model Admin {
    id       String @id @default(cuid())
    username String @unique
    password String
    phone_no BigInt
}

enum Category {
    Canteen
    Den
    Ration
    Essential
    Resturant
}

model Shop {
    id           String   @id @default(cuid())
    username     String   @unique
    password     String
    shop_name    String
    address      String
    rating       Float    @default(0.0)
    rating_count BigInt   @default(0)
    phone_no     BigInt
    img_url      String
    category     Category
    active       Boolean  @default(true)

    total_seat     Int?
    available_seat Int?

    total_revenue   BigInt @default(0)
    commission      BigInt @default(0)
    avg_order_value BigInt @default(0)

    inventory Inventory[]
    Orders    Orders[]
}

model Delivery {
    id       String   @id @default(cuid())
    username String   @unique
    password String
    phone_no BigInt
    img_url  String
    Orders   Orders[]
}

model Inventory {
    id           String @id @default(cuid())
    name         String @unique
    price        Float
    retail_price Float
    rating       Float  @default(0.0)
    rating_count BigInt @default(0)
    img_url      String
    count        Int

    shopId     String
    shop       Shop         @relation(fields: [shopId], references: [id], onDelete: Cascade)
    OrderItems OrderItems[]
}

model UserAddress {
    id          String @id @default(cuid())
    line1       String
    line2       String
    landmark    String
    city        String
    postal_code Int

    userId String   @unique
    user   User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    Orders Orders[]
}

enum OrderStatus {
    PENDING
    CONFIRMED
    DELIVERED
}

model Orders {
    id         String      @id @default(cuid())
    totalprice Float
    status     OrderStatus @default(PENDING)
    createdAt  DateTime    @default(now())
    updatedAt  DateTime    @updatedAt

    items OrderItems[]

    addressId  String
    address    UserAddress @relation(fields: [addressId], references: [id])
    deliveryId String?
    delivery   Delivery?   @relation(fields: [deliveryId], references: [id])
    shopId     String
    shop       Shop        @relation(fields: [shopId], references: [id])
}

model OrderItems {
    id          String @id @default(cuid())
    quantity    Int
    priceAtTime Float

    Orders      Orders?   @relation(fields: [ordersId], references: [id])
    ordersId    String?
    inventoryId String
    inventory   Inventory @relation(fields: [inventoryId], references: [id])
}

model OrderIntermidates {
    id          String @id @default(cuid())
    orderId String @unique
    address String
    }
